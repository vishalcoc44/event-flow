"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1347],{56345:(e,t,r)=>{r.d(t,{BookingProvider:()=>a,W:()=>s});var i=r(95155),l=r(12115),n=r(85534);let o=(0,l.createContext)(void 0),a=e=>{let{children:t}=e,[r,a]=(0,l.useState)([]),[s,u]=(0,l.useState)(!0),[d,c]=(0,l.useState)(null),v=async()=>{try{u(!0),c(null);let e=await n.Bn.getAllBookings();a(e||[])}catch(e){console.error("Error fetching bookings:",e),c(e.message||"Failed to fetch bookings")}finally{u(!1)}};(0,l.useEffect)(()=>{v()},[]);let g=async e=>{try{u(!0),c(null);let t=await n.Bn.createBooking(e);return t&&a(e=>[...e,t]),t}catch(e){return console.error("Error adding booking:",e),c(e.message||"Failed to add booking"),null}finally{u(!1)}},f=async e=>{try{u(!0),c(null);let t=await n.Bn.cancelBooking(e);return t&&a(t=>t.map(t=>t.id===e?{...t,status:"CANCELLED"}:t)),t}catch(e){return console.error("Error cancelling booking:",e),c(e.message||"Failed to cancel booking"),null}finally{u(!1)}},h=async()=>{try{return u(!0),c(null),await n.Bn.getUserBookings()||[]}catch(e){return console.error("Error getting user bookings:",e),c(e.message||"Failed to get user bookings"),[]}finally{u(!1)}},w=async()=>{try{return u(!0),c(null),await n.Bn.getAllBookings()||[]}catch(e){return console.error("Error getting all bookings:",e),c(e.message||"Failed to get all bookings"),[]}finally{u(!1)}};return(0,i.jsx)(o.Provider,{value:{bookings:r,loading:s,error:d,addBooking:g,cancelBooking:f,getUserBookings:h,getAllBookings:w,fetchBookings:v},children:t})},s=()=>{let e=(0,l.useContext)(o);if(void 0===e)throw Error("useBookings must be used within a BookingProvider");return e}},98470:(e,t,r)=>{r.d(t,{EventProvider:()=>a,L:()=>s});var i=r(95155),l=r(12115),n=r(85534);let o=(0,l.createContext)(void 0),a=e=>{let{children:t}=e,[r,a]=(0,l.useState)([]),[s,u]=(0,l.useState)(!0),[d,c]=(0,l.useState)(null),v=async()=>{try{u(!0),c(null);let e=await n.MT.getAllEvents();a(e||[])}catch(e){console.error("Error fetching events:",e),c(e.message||"Failed to fetch events")}finally{u(!1)}};(0,l.useEffect)(()=>{v()},[]);let g=async e=>{try{u(!0),c(null);let t=await n.MT.createEvent(e);return t&&a(e=>[...e,t]),t}catch(e){return console.error("Error adding event:",e),c(e.message||"Failed to add event"),null}finally{u(!1)}},f=async(e,t)=>{try{u(!0),c(null);let r=await n.MT.updateEvent(e,t);return r&&a(t=>t.map(t=>t.id===e?{...t,...r}:t)),r}catch(e){return console.error("Error updating event:",e),c(e.message||"Failed to update event"),null}finally{u(!1)}},h=async e=>{try{u(!0),c(null);let t=await n.MT.deleteEvent(e);return t.success&&a(t=>t.filter(t=>t.id!==e)),t.success}catch(e){return console.error("Error deleting event:",e),c(e.message||"Failed to delete event"),!1}finally{u(!1)}};return(0,i.jsx)(o.Provider,{value:{events:r,loading:s,error:d,addEvent:g,updateEvent:f,deleteEvent:h,fetchEvents:v},children:t})},s=()=>{let e=(0,l.useContext)(o);if(void 0===e)throw Error("useEvents must be used within an EventProvider");return e}},78972:(e,t,r)=>{r.d(t,{ReviewProvider:()=>u,v:()=>s});var i=r(95155),l=r(12115),n=r(11712),o=r(17146);let a=(0,l.createContext)(void 0),s=()=>{let e=(0,l.useContext)(a);if(void 0===e)throw Error("useReviews must be used within a ReviewProvider");return e},u=e=>{let{children:t}=e,{user:r}=(0,o.A)(),[s,u]=(0,l.useState)([]),[d,c]=(0,l.useState)(null),[v,g]=(0,l.useState)(!1),[f,h]=(0,l.useState)(null),w=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"created_at",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"DESC";if(e)try{g(!0),h(null);let a=n.ND.from("reviews").select("\n          *,\n          events!inner(title),\n          review_helpful_votes!left(id, is_helpful, user_id)\n        ").eq("event_id",e).order(l,{ascending:"ASC"===o}).range(i,i+t-1),{data:s,error:d}=await a;if(d)throw d;let c=(s||[]).map(e=>{var t,i;let l=null===(t=e.review_helpful_votes)||void 0===t?void 0:t.find(e=>e.user_id===(null==r?void 0:r.id)),n=(null===(i=e.review_helpful_votes)||void 0===i?void 0:i.filter(e=>!0===e.is_helpful).length)||0;return{id:e.id,event_id:e.event_id,user_id:e.user_id,username:"Anonymous",rating:e.rating,title:e.title,comment:e.comment,is_verified:e.is_verified,is_helpful:e.is_helpful,created_at:e.created_at,updated_at:e.updated_at,helpful_votes_count:n,user_helpful_vote:null==l?void 0:l.is_helpful}});u(c)}catch(e){console.error("Error loading reviews:",e),h(e.message||"Failed to load reviews")}finally{g(!1)}},_=async e=>{if(e)try{h(null);let{data:t,error:r}=await n.ND.from("event_rating_summary").select("*").eq("event_id",e).single();if(r&&"PGRST116"!==r.code)throw r;c(t||null)}catch(e){console.error("Error loading rating summary:",e),h(e.message||"Failed to load rating summary")}},m=async e=>{if(!r)return!1;try{console.log("Testing review system...");let t=await y(e,5,"Test Review","This is a test review",!0);return console.log("Review added successfully:",t),await w(e),console.log("Reviews loaded successfully"),await _(e),console.log("Rating summary loaded successfully"),!0}catch(e){return console.error("Test failed:",e),!1}},y=async function(e,t,i,l){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!r)throw Error("User not authenticated");try{h(null);let{data:a,error:s}=await n.ND.from("reviews").insert({event_id:e,user_id:r.id,rating:t,title:i||null,comment:l||null,is_verified:o}).select().single();if(s)throw s;return await w(e),await _(e),a.id}catch(e){throw console.error("Error adding review:",e),h(e.message||"Failed to add review"),e}},p=async(e,t,i,l)=>{if(!r)return!1;try{h(null);let{error:o}=await n.ND.from("reviews").update({rating:t||void 0,title:i||null,comment:l||null,updated_at:new Date().toISOString()}).eq("id",e).eq("user_id",r.id);if(o)throw o;return s.length>0&&await w(s[0].event_id),!0}catch(e){return console.error("Error updating review:",e),h(e.message||"Failed to update review"),!1}},E=async e=>{if(!r)return!1;try{h(null);let{error:t}=await n.ND.from("reviews").delete().eq("id",e).eq("user_id",r.id);if(t)throw t;return u(t=>t.filter(t=>t.id!==e)),s.length>0&&await _(s[0].event_id),!0}catch(e){return console.error("Error deleting review:",e),h(e.message||"Failed to delete review"),!1}},k=async(e,t)=>{if(!r)return!1;try{h(null);let i=s.find(t=>t.id===e),l=null==i?void 0:i.user_helpful_vote;if(l===t){let{error:i}=await n.ND.from("review_helpful_votes").delete().eq("review_id",e).eq("user_id",r.id);if(i)throw i;u(r=>r.map(r=>r.id===e?{...r,helpful_votes_count:t?Math.max(0,(r.helpful_votes_count||0)-1):r.helpful_votes_count||0,user_helpful_vote:void 0}:r))}else{let{data:i,error:o}=await n.ND.from("review_helpful_votes").select("*").eq("review_id",e).eq("user_id",r.id).single();if(o&&"PGRST116"!==o.code)throw o;if(i){let{error:i}=await n.ND.from("review_helpful_votes").update({is_helpful:t}).eq("review_id",e).eq("user_id",r.id);if(i)throw i}else{let{error:i}=await n.ND.from("review_helpful_votes").insert({review_id:e,user_id:r.id,is_helpful:t});if(i)throw i}u(r=>r.map(r=>{if(r.id===e){let e=r.helpful_votes_count||0;return!0===l&&(e-=1),t&&(e+=1),{...r,helpful_votes_count:Math.max(0,e),user_helpful_vote:t}}return r}))}return!0}catch(e){return console.error("Error voting on review:",e),h(e.message||"Failed to vote on review"),!1}},b=async(e,t,i)=>{if(!r)throw Error("User not authenticated");try{h(null);let{data:l,error:o}=await n.ND.from("review_reports").insert({review_id:e,reporter_id:r.id,reason:t,description:i||null,status:"pending"}).select().single();if(o)throw o;return l.id}catch(e){throw console.error("Error reporting review:",e),h(e.message||"Failed to report review"),e}};return(0,i.jsx)(a.Provider,{value:{reviews:s,ratingSummary:d,loading:v,error:f,loadEventReviews:w,loadEventRatingSummary:_,addReview:y,updateReview:p,deleteReview:E,voteHelpful:k,reportReview:b,canReviewEvent:e=>!(!r||s.some(e=>e.user_id===r.id)),getUserReview:e=>r&&s.find(e=>e.user_id===r.id)||null,getAverageRating:()=>0===s.length?0:Math.round(s.reduce((e,t)=>e+t.rating,0)/s.length*10)/10,getRatingDistribution:()=>{let e={1:0,2:0,3:0,4:0,5:0};return s.forEach(t=>{e[t.rating]=(e[t.rating]||0)+1}),e},testReviewSystem:m},children:t})}}}]);
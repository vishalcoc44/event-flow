(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4700],{98265:(e,s,t)=>{Promise.resolve().then(t.bind(t,99393))},99393:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>m});var r=t(95155),i=t(12115),a=t(76046),n=t(47548),o=t(4370),l=t(33900),d=t(73312),c=t(7223),u=t(11712);function p(){let e=(0,a.useSearchParams)(),s=(0,a.useRouter)(),{toast:t}=(0,c.dj)(),[p,m]=(0,i.useState)(""),[h,x]=(0,i.useState)(""),[f,g]=(0,i.useState)(!1),[w,v]=(0,i.useState)(null),[b,j]=(0,i.useState)(!1),S=(null==e?void 0:e.get("access_token"))||"",y=(null==e?void 0:e.get("refresh_token"))||"",N=(null==e?void 0:e.get("type"))||"";(0,i.useEffect)(()=>{let r=async()=>{if(console.log("Reset page params:",{accessToken:S,refreshToken:y,type:N}),console.log("All URL params:",Object.fromEntries((null==e?void 0:e.entries())||[])),"recovery"===N&&S&&y)try{let{data:e,error:r}=await u.ND.auth.setSession({access_token:S,refresh_token:y});if(r){console.error("Error setting session:",r),t({title:"Invalid link",description:"This password reset link is invalid or expired."}),s.push("/login");return}j(!0)}catch(e){console.error("Session error:",e),t({title:"Invalid link",description:"This password reset link is invalid or expired."}),s.push("/login")}else if(S)try{let{data:e,error:r}=await u.ND.auth.setSession({access_token:S,refresh_token:y||""});if(r){console.error("Error setting session:",r),t({title:"Invalid link",description:"This password reset link is invalid or expired."}),s.push("/login");return}j(!0)}catch(e){console.error("Session error:",e),t({title:"Invalid link",description:"This password reset link is invalid or expired."}),s.push("/login")}else t({title:"Invalid link",description:"This password reset link is invalid or expired."}),s.push("/login")};S||y||N?r():s.push("/login")},[S,y,N,s,t]);let T=async e=>{if(e.preventDefault(),v(null),!p||p.length<8){v("Password must be at least 8 characters.");return}if(p!==h){v("Passwords do not match.");return}g(!0);try{let{data:e,error:r}=await u.ND.auth.updateUser({password:p});if(r){v(r.message||"Failed to update password."),t({title:"Reset failed",description:r.message||"Failed to update password.",variant:"destructive"}),g(!1);return}t({title:"Password updated",description:"You can now sign in with your new password."}),await u.ND.auth.signOut(),s.push("/login")}catch(e){console.error("Reset error:",e),v((null==e?void 0:e.message)||"Failed to reset password."),t({title:"Error",description:(null==e?void 0:e.message)||"Failed to reset password.",variant:"destructive"})}finally{g(!1)}};return b?(0,r.jsxs)("div",{className:"min-h-screen flex flex-col bg-white",children:[(0,r.jsx)(n.A,{}),(0,r.jsx)("main",{className:"flex-grow py-12",children:(0,r.jsx)("div",{className:"container mx-auto px-4",children:(0,r.jsxs)("div",{className:"max-w-md mx-auto bg-white p-8 rounded-lg shadow",children:[(0,r.jsx)("h1",{className:"text-2xl font-semibold mb-2",children:"Set a new password"}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:"Enter a strong new password for your account."}),w&&(0,r.jsx)("div",{className:"bg-red-50 text-red-600 p-3 rounded mb-4",children:w}),(0,r.jsxs)("form",{onSubmit:T,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"New password"}),(0,r.jsx)(l.p,{value:p,onChange:e=>m(e.target.value),type:"password",placeholder:"New password",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm password"}),(0,r.jsx)(l.p,{value:h,onChange:e=>x(e.target.value),type:"password",placeholder:"Confirm password",required:!0})]}),(0,r.jsx)(d.$,{type:"submit",className:"w-full",disabled:f,children:f?"Saving...":"Save password"})]})]})})}),(0,r.jsx)(o.A,{})]}):(0,r.jsxs)("div",{className:"min-h-screen flex flex-col bg-white",children:[(0,r.jsx)(n.A,{}),(0,r.jsx)("main",{className:"flex-grow py-12",children:(0,r.jsx)("div",{className:"container mx-auto px-4",children:(0,r.jsxs)("div",{className:"max-w-md mx-auto bg-white p-8 rounded-lg shadow text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Setting up password reset..."})]})})}),(0,r.jsx)(o.A,{})]})}function m(){return(0,r.jsx)(i.Suspense,{fallback:(0,r.jsx)("div",{className:"min-h-screen bg-white flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"w-8 h-8 border-4 border-t-[#6CDAEC] rounded-full animate-spin mx-auto mb-4"}),(0,r.jsx)("p",{children:"Loading..."})]})}),children:(0,r.jsx)(p,{})})}},33900:(e,s,t)=>{"use strict";t.d(s,{p:()=>n});var r=t(95155),i=t(12115),a=t(21567);let n=i.forwardRef((e,s)=>{let{className:t,type:i,...n}=e;return(0,r.jsx)("input",{type:i,className:(0,a.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:s,...n})});n.displayName="Input"},7223:(e,s,t)=>{"use strict";t.d(s,{dj:()=>p,oR:()=>u});var r=t(12115);let i=0,a=new Map,n=e=>{if(a.has(e))return;let s=setTimeout(()=>{a.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);a.set(e,s)},o=(e,s)=>{switch(s.type){case"ADD_TOAST":return{...e,toasts:[s.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===s.toast.id?{...e,...s.toast}:e)};case"DISMISS_TOAST":{let{toastId:t}=s;return t?n(t):e.toasts.forEach(e=>{n(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===t||void 0===t?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===s.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==s.toastId)}}},l=[],d={toasts:[]};function c(e){d=o(d,e),l.forEach(e=>{e(d)})}function u(e){let{...s}=e,t=(i=(i+1)%Number.MAX_VALUE).toString(),r=()=>c({type:"DISMISS_TOAST",toastId:t});return c({type:"ADD_TOAST",toast:{...s,id:t,open:!0,onOpenChange:e=>{e||r()}}}),{id:t,dismiss:r,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function p(){let[e,s]=r.useState(d);return r.useEffect(()=>(l.push(s),()=>{let e=l.indexOf(s);e>-1&&l.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}}},e=>{var s=s=>e(e.s=s);e.O(0,[1181,6232,3081,2809,7506,4934,8455,975,8441,1517,7358],()=>s(98265)),_N_E=e.O()}]);
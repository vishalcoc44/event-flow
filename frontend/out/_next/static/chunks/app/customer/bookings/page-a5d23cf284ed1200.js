(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4708],{98796:(e,t,s)=>{Promise.resolve().then(s.bind(s,75879))},32423:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});let i=(0,s(67401).A)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},66889:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});let i=(0,s(67401).A)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},14807:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});let i=(0,s(67401).A)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},57223:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});let i=(0,s(67401).A)("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},20853:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});let i=(0,s(67401).A)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},75879:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>w});var i=s(95155),a=s(48173),l=s.n(a),n=s(17146),r=s(56345),o=s(22130),c=s(73312),d=s(25121),u=s(33900),x=s(71714),h=s(25683),v=s(12115),g=s(47548),m=s(4370),y=s(7223),p=s(20853),f=s(32423),j=s(66889),b=s(57223),N=s(14807),k=s(67427);function w(){let{user:e}=(0,n.A)(),{bookings:t,loading:s,error:a,cancelBooking:w}=(0,r.W)(),{toast:A}=(0,y.dj)(),[E,C]=(0,v.useState)(""),[S,T]=(0,v.useState)("all"),[I,B]=(0,v.useState)(null),[D,P]=(0,v.useState)([]);(0,v.useEffect)(()=>{e&&t&&P(t.filter(t=>t.user_id===e.id))},[e,t]);let _=D.reduce((e,t)=>{var s,i,a;let l=null===(s=t.event)||void 0===s?void 0:s.id;if(!l)return e;let n=e.find(e=>e.eventId===l);return n?(n.bookings.push(t),n.quantity+=1,n.totalPrice+=(null===(i=t.event)||void 0===i?void 0:i.price)||0):e.push({eventId:l,event:t.event,bookings:[t],quantity:1,totalPrice:(null===(a=t.event)||void 0===a?void 0:a.price)||0,status:t.status,firstBookingId:t.id}),e},[]).filter(e=>{var t,s,i,a;let l=(null===(s=e.event)||void 0===s?void 0:null===(t=s.title)||void 0===t?void 0:t.toLowerCase().includes(E.toLowerCase()))||(null===(a=e.event)||void 0===a?void 0:null===(i=a.location)||void 0===i?void 0:i.toLowerCase().includes(E.toLowerCase())),n="all"===S||e.status.toLowerCase()===S.toLowerCase();return l&&n}),L=async e=>{try{var t;B(e.firstBookingId);let s=e.bookings.map(e=>w(e.id));await Promise.all(s),A({title:"Bookings Cancelled",description:"Successfully cancelled ".concat(e.quantity," ticket(s) for ").concat(null===(t=e.event)||void 0===t?void 0:t.title)})}catch(e){A({title:"Error",description:e.message||"Failed to cancel bookings",variant:"destructive"})}finally{B(null)}},M=e=>{switch(e.toUpperCase()){case"CONFIRMED":return"bg-green-100 text-green-800";case"PENDING":return"bg-yellow-100 text-yellow-800";case"CANCELLED":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return(0,i.jsxs)("div",{className:"min-h-screen flex flex-col bg-white",children:[(0,i.jsx)(g.A,{user:e?{role:"USER"===e.role?"customer":e.role}:null}),(0,i.jsxs)("main",{className:"flex-grow container mx-auto px-4 py-8",children:[(0,i.jsxs)(x.P.div,{className:"mb-8",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.6},children:[(0,i.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"My Bookings"}),(0,i.jsx)("p",{className:"text-gray-600",children:"Manage and view all your event bookings"})]}),(0,i.jsx)(x.P.div,{className:"mb-6",initial:{opacity:0,y:40},whileInView:{opacity:1,y:0},viewport:{once:!0,margin:"-50px"},transition:{duration:.8,delay:.2},children:(0,i.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,i.jsxs)("div",{className:"relative flex-grow",children:[(0,i.jsx)(p.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,i.jsx)(u.p,{type:"text",placeholder:"Search bookings by event title or location...",className:"pl-10",value:E,onChange:e=>C(e.target.value)})]}),(0,i.jsx)("div",{className:"flex gap-2",children:(0,i.jsxs)("select",{value:S,onChange:e=>T(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-[#6CDAEC] focus:border-transparent",children:[(0,i.jsx)("option",{value:"all",children:"All Status"}),(0,i.jsx)("option",{value:"confirmed",children:"Confirmed"}),(0,i.jsx)("option",{value:"pending",children:"Pending"}),(0,i.jsx)("option",{value:"cancelled",children:"Cancelled"})]})})]})}),s?(0,i.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,i.jsx)(x.P.div,{className:"w-12 h-12 border-4 border-t-[#6CDAEC] rounded-full",animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"}})}):a?(0,i.jsx)("div",{className:"bg-red-50 p-4 rounded-md text-red-800",children:(0,i.jsxs)("p",{children:["Error loading bookings: ",a]})}):0===_.length?(0,i.jsxs)("div",{className:"text-center py-12",children:[(0,i.jsx)("div",{className:"text-gray-400 mb-4",children:(0,i.jsx)(f.A,{className:"h-12 w-12 mx-auto"})}),(0,i.jsx)("h3",{className:"text-xl font-medium text-gray-600 mb-4",children:"No bookings found"}),(0,i.jsx)("p",{className:"text-gray-500 mb-6",children:E||"all"!==S?"We couldn't find any bookings matching your criteria.":"You haven't made any bookings yet."}),E||"all"!==S?(0,i.jsx)(c.$,{onClick:()=>{C(""),T("all")},children:"Clear Filters"}):(0,i.jsx)(c.$,{asChild:!0,children:(0,i.jsx)("a",{href:"/events",children:"Browse Events"})})]}):(0,i.jsx)(x.P.div,{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",initial:{opacity:0,y:40},whileInView:{opacity:1,y:0},viewport:{once:!0,margin:"-50px"},transition:{duration:.8,delay:.2},children:(0,i.jsx)(h.N,{children:_.map((e,t)=>{var s,a,n,r,u,h,v;return(0,i.jsx)(x.P.div,{initial:{opacity:0,y:30},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{duration:.6,delay:.1*t},whileHover:{scale:1.02,transition:{duration:.2}},layout:!0,children:(0,i.jsx)(k.Wq,{className:"overflow-hidden border border-gray-200 rounded-2xl cursor-pointer",shadowColor:"rgba(0,0,0,0.15)",shadowIntensity:.2,children:(0,i.jsxs)(o.Zp,{className:"overflow-hidden border-0 shadow-none",children:[(0,i.jsxs)("div",{className:"relative h-48",children:[(0,i.jsx)("img",{src:(null===(s=e.event)||void 0===s?void 0:s.image_url)||"https://via.placeholder.com/400x200?text=Event",alt:null===(a=e.event)||void 0===a?void 0:a.title,className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src="https://via.placeholder.com/400x200?text=Event"}}),(0,i.jsx)("div",{className:"absolute top-2 right-2",children:(0,i.jsx)(d.E,{className:M(e.status),children:e.status})}),e.quantity>1&&(0,i.jsx)("div",{className:"absolute top-2 left-2",children:(0,i.jsxs)(d.E,{className:"bg-[#6CDAEC] text-white",children:[e.quantity," Tickets"]})})]}),(0,i.jsx)(o.aR,{className:"pb-2",children:(0,i.jsx)(o.ZB,{className:"text-lg font-semibold text-gray-900",children:(null===(n=e.event)||void 0===n?void 0:n.title)||"Unknown Event"})}),(0,i.jsx)(o.Wu,{className:"pt-0 pb-4",children:(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(f.A,{className:"h-4 w-4 text-gray-500"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"font-medium",children:"Event Date:"})," ",(null===(r=e.event)||void 0===r?void 0:r.date)?new Date(e.event.date).toLocaleDateString():"N/A"]})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(j.A,{className:"h-4 w-4 text-gray-500"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"font-medium",children:"Event Time:"})," ",(null===(u=e.event)||void 0===u?void 0:u.time)||"N/A"]})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(b.A,{className:"h-4 w-4 text-gray-500"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"font-medium",children:"Location:"})," ",(null===(h=e.event)||void 0===h?void 0:h.location)||"N/A"]})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(N.A,{className:"h-4 w-4 text-gray-500"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"font-medium",children:"Total Price:"})," ","$",e.totalPrice.toFixed(2)]})]}),e.quantity>1&&(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("div",{className:"h-4 w-4 text-gray-500 flex items-center justify-center",children:(0,i.jsx)("span",{className:"text-xs",children:"\xd7"})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"font-medium",children:"Quantity:"})," ",e.quantity," ticket(s) @ $",null===(v=e.event)||void 0===v?void 0:v.price," each"]})]})]})}),(0,i.jsx)(o.wL,{className:"border-t bg-gray-50 py-3",children:(0,i.jsxs)("div",{className:"flex justify-between w-full",children:[(0,i.jsx)(l(),{href:"/events/".concat(e.eventId),children:(0,i.jsx)(c.$,{variant:"outline",size:"sm",children:"Event Details"})}),"CANCELLED"!==e.status&&(0,i.jsx)(c.$,{variant:"destructive",size:"sm",onClick:()=>L(e),disabled:I===e.firstBookingId,children:I===e.firstBookingId?"Cancelling...":"Cancel ".concat(e.quantity>1?"All Tickets":"Booking")})]})})]})})},e.eventId)})})})]}),(0,i.jsx)(m.A,{})]})}},33900:(e,t,s)=>{"use strict";s.d(t,{p:()=>n});var i=s(95155),a=s(12115),l=s(21567);let n=a.forwardRef((e,t)=>{let{className:s,type:a,...n}=e;return(0,i.jsx)("input",{type:a,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...n})});n.displayName="Input"},7223:(e,t,s)=>{"use strict";s.d(t,{dj:()=>x,oR:()=>u});var i=s(12115);let a=0,l=new Map,n=e=>{if(l.has(e))return;let t=setTimeout(()=>{l.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);l.set(e,t)},r=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?n(s):e.toasts.forEach(e=>{n(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},o=[],c={toasts:[]};function d(e){c=r(c,e),o.forEach(e=>{e(c)})}function u(e){let{...t}=e,s=(a=(a+1)%Number.MAX_VALUE).toString(),i=()=>d({type:"DISMISS_TOAST",toastId:s});return d({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:e=>{e||i()}}}),{id:s,dismiss:i,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:s}})}}function x(){let[e,t]=i.useState(c);return i.useEffect(()=>(o.push(t),()=>{let e=o.indexOf(t);e>-1&&o.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},56345:(e,t,s)=>{"use strict";s.d(t,{BookingProvider:()=>r,W:()=>o});var i=s(95155),a=s(12115),l=s(85534);let n=(0,a.createContext)(void 0),r=e=>{let{children:t}=e,[s,r]=(0,a.useState)([]),[o,c]=(0,a.useState)(!0),[d,u]=(0,a.useState)(null),x=async()=>{try{c(!0),u(null);let e=await l.Bn.getAllBookings();r(e||[])}catch(e){console.error("Error fetching bookings:",e),u(e.message||"Failed to fetch bookings")}finally{c(!1)}};(0,a.useEffect)(()=>{x()},[]);let h=async e=>{try{c(!0),u(null);let t=await l.Bn.createBooking(e);return t&&r(e=>[...e,t]),t}catch(e){return console.error("Error adding booking:",e),u(e.message||"Failed to add booking"),null}finally{c(!1)}},v=async e=>{try{c(!0),u(null);let t=await l.Bn.cancelBooking(e);return t&&r(t=>t.map(t=>t.id===e?{...t,status:"CANCELLED"}:t)),t}catch(e){return console.error("Error cancelling booking:",e),u(e.message||"Failed to cancel booking"),null}finally{c(!1)}},g=async()=>{try{return c(!0),u(null),await l.Bn.getUserBookings()||[]}catch(e){return console.error("Error getting user bookings:",e),u(e.message||"Failed to get user bookings"),[]}finally{c(!1)}},m=async()=>{try{return c(!0),u(null),await l.Bn.getAllBookings()||[]}catch(e){return console.error("Error getting all bookings:",e),u(e.message||"Failed to get all bookings"),[]}finally{c(!1)}};return(0,i.jsx)(n.Provider,{value:{bookings:s,loading:o,error:d,addBooking:h,cancelBooking:v,getUserBookings:g,getAllBookings:m,fetchBookings:x},children:t})},o=()=>{let e=(0,a.useContext)(n);if(void 0===e)throw Error("useBookings must be used within a BookingProvider");return e}}},e=>{var t=t=>e(e.s=t);e.O(0,[1181,6232,3081,2809,7506,4934,8455,975,5534,8441,1517,7358],()=>t(98796)),_N_E=e.O()}]);
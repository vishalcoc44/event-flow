(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2080],{33146:(e,t,r)=>{Promise.resolve().then(r.bind(r,79667))},79667:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>p});var a=r(95155),s=r(12115),n=r(22130),i=r(73312),o=r(25121),l=r(67427),c=r(8),d=r(21567);let u=s.forwardRef((e,t)=>{let{className:r,value:s,...n}=e;return(0,a.jsx)(c.bL,{ref:t,className:(0,d.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",r),...n,children:(0,a.jsx)(c.C1,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(s||0),"%)")}})})});u.displayName=c.bL.displayName;var m=r(65564),x=r(11712),h=r(47767);let g=(0,r(77711).default)(()=>r.e(6625).then(r.bind(r,76625)),{loadableGenerated:{webpack:()=>[76625]},ssr:!1});function p(){let{organization:e}=(0,h.Z)(),{plans:t,currentPlan:r,usage:c,loading:d,error:p,updateSubscriptionPlan:f,getUsagePercentages:_,getUsageAlerts:b}=function(){let{organization:e}=(0,h.Z)(),[t,r]=(0,s.useState)([]),[a,n]=(0,s.useState)(null),[i,o]=(0,s.useState)(null),[l,c]=(0,s.useState)(!0),[d,u]=(0,s.useState)(null),m=async()=>{try{let{data:e,error:t}=await x.ND.from("subscription_plans").select("*").eq("is_active",!0).order("price_monthly",{ascending:!0});if(t)throw t;r(e||[])}catch(e){u(e.message)}},g=async()=>{if(e)try{let{data:t,error:r}=await x.ND.from("subscription_plans").select("*").eq("name",e.subscription_plan).single();if(r)throw r;n(t),o({current_events_count:e.current_events_count,current_users_count:e.current_users_count,current_storage_mb:e.current_storage_mb,max_events:e.max_events,max_users:e.max_users,max_storage_mb:e.max_storage_mb})}catch(e){u(e.message)}},p=async t=>{if(!e)throw Error("No organization context");try{let{data:r,error:a}=await x.ND.from("subscription_plans").select("*").eq("name",t).single();if(a)throw a;let{error:s}=await x.ND.from("organizations").update({subscription_plan:t,max_events:r.max_events,max_users:r.max_users,max_storage_mb:r.max_storage_mb,updated_at:new Date().toISOString()}).eq("id",e.id);if(s)throw s;return n(r),i&&o({...i,max_events:r.max_events,max_users:r.max_users,max_storage_mb:r.max_storage_mb}),{success:!0}}catch(e){throw Error(e.message)}},f=()=>i?{events:i.current_events_count/i.max_events*100,users:i.current_users_count/i.max_users*100,storage:i.current_storage_mb/i.max_storage_mb*100}:{events:0,users:0,storage:0},_=async()=>{if(e)try{let[t,r]=await Promise.all([x.ND.from("events").select("id",{count:"exact",head:!0}).eq("organization_id",e.id),x.ND.from("users").select("id",{count:"exact",head:!0}).eq("organization_id",e.id)]),a=t.count||0,s=r.count||0,{error:n}=await x.ND.from("organizations").update({current_events_count:a,current_users_count:s,updated_at:new Date().toISOString()}).eq("id",e.id);if(n)throw n;i&&o({...i,current_events_count:a,current_users_count:s})}catch(e){console.error("Error updating usage:",e.message)}};return(0,s.useEffect)(()=>{(async()=>{c(!0),await Promise.all([m(),g()]),c(!1)})()},[e]),{plans:t,currentPlan:a,usage:i,loading:l,error:d,updateSubscriptionPlan:p,getUsagePercentages:f,getUsageAlerts:()=>{let e=f(),t=[];return e.events>80&&t.push("You are using ".concat(e.events.toFixed(0),"% of your event limit.")),e.users>80&&t.push("You are using ".concat(e.users.toFixed(0),"% of your user limit.")),e.storage>80&&t.push("You are using ".concat(e.storage.toFixed(0),"% of your storage limit.")),t},updateUsage:_,refetch:()=>Promise.all([m(),g()])}}(),{invoices:y,loading:v,generateInvoice:w,markInvoiceAsPaid:N}=function(){let{organization:e}=(0,h.Z)(),[t,r]=(0,s.useState)([]),[a,n]=(0,s.useState)(!0),[i,o]=(0,s.useState)(null),l=async()=>{if(e)try{n(!0);let t=[{id:"1",invoice_number:"INV-2024-001",amount:"BASIC"===e.subscription_plan?19.99:"PRO"===e.subscription_plan?49.99:"ENTERPRISE"===e.subscription_plan?99.99:0,currency:"USD",status:"PAID",issue_date:"2024-04-01",due_date:"2024-04-01",paid_date:"2024-04-01",payment_method:"Credit Card **** 4242",plan_name:e.subscription_plan,billing_period_start:"2024-04-01",billing_period_end:"2024-05-01"},{id:"2",invoice_number:"INV-2024-002",amount:"BASIC"===e.subscription_plan?19.99:"PRO"===e.subscription_plan?49.99:"ENTERPRISE"===e.subscription_plan?99.99:0,currency:"USD",status:"PAID",issue_date:"2024-03-01",due_date:"2024-03-01",paid_date:"2024-03-01",payment_method:"Credit Card **** 4242",plan_name:e.subscription_plan,billing_period_start:"2024-03-01",billing_period_end:"2024-04-01"}];r(t)}catch(e){o(e.message)}finally{n(!1)}},c=async(a,s)=>{if(!e)throw Error("No organization context");let n={id:Date.now().toString(),invoice_number:"INV-".concat(new Date().getFullYear(),"-").concat(String(t.length+1).padStart(3,"0")),amount:s,currency:"USD",status:"PENDING",issue_date:new Date().toISOString().split("T")[0],due_date:new Date().toISOString().split("T")[0],plan_name:a,billing_period_start:new Date().toISOString().split("T")[0],billing_period_end:new Date(Date.now()+2592e6).toISOString().split("T")[0]};return r(e=>[n,...e]),n},d=async(e,t)=>{r(r=>r.map(r=>r.id===e?{...r,status:"PAID",paid_date:new Date().toISOString().split("T")[0],payment_method:t||"Credit Card"}:r))};return(0,s.useEffect)(()=>{l()},[e]),{invoices:t,loading:a,error:i,generateInvoice:c,markInvoiceAsPaid:d,refetch:l}}(),{toast:j}=(0,m.dj)(),[S,E]=(0,s.useState)(!1),[I,D]=(0,s.useState)(!1);if(d||!e)return(0,a.jsx)("div",{className:"min-h-screen flex flex-col bg-white",children:(0,a.jsxs)("main",{className:"flex-grow container mx-auto px-4 py-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-6 text-center",children:"Subscription & Usage"}),(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,a.jsx)("div",{className:"text-gray-500",children:"Loading subscription data..."})})]})});if(p)return(0,a.jsx)("div",{className:"min-h-screen flex flex-col bg-white",children:(0,a.jsxs)("main",{className:"flex-grow container mx-auto px-4 py-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-6 text-center",children:"Subscription & Usage"}),(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,a.jsxs)("div",{className:"text-red-600",children:["Error loading subscription: ",p]})})]})});let z=_(),C=b(),T=async e=>{if(r&&e!==r.name){D(!0);try{let r=t.find(t=>t.name===e);if(!r)throw Error("Plan not found");await w(r.name,r.price_monthly),await f(e),j({title:"Plan Updated",description:"Successfully upgraded to ".concat(r.display_name," plan.")}),E(!1)}catch(e){j({title:"Update Failed",description:e.message,variant:"destructive"})}finally{D(!1)}}},P=(e,t)=>0===e?"Free":"$".concat(e,"/mo");return(0,a.jsx)("div",{className:"min-h-screen flex flex-col bg-white",children:(0,a.jsxs)("main",{className:"flex-grow container mx-auto px-4 py-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-6 text-center",children:"Subscription & Usage"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 mb-12",children:[(0,a.jsxs)(l.Wq,{className:"border rounded-lg p-6 flex flex-col",shadowColor:"rgba(0,0,0,0.08)",shadowIntensity:.12,hoverScale:1.02,hoverLift:-1,transitionDuration:150,children:[(0,a.jsx)(n.aR,{children:(0,a.jsxs)(n.ZB,{className:"flex items-center gap-2",children:["Current Plan",(0,a.jsx)(o.E,{variant:"default",children:(null==r?void 0:r.display_name)||e.subscription_plan})]})}),(0,a.jsxs)(n.Wu,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-primary mb-2",children:r?P(r.price_monthly,r.price_yearly):"Loading..."}),(0,a.jsxs)("div",{className:"text-gray-600 mb-4",children:["Billed monthly. Next payment: ",(()=>{if(!e.subscription_start_date)return"N/A";let t=new Date(new Date(e.subscription_start_date));return t.setMonth(t.getMonth()+1),t.toLocaleDateString()})()]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"Status:"}),(0,a.jsx)("div",{className:"flex items-center gap-2 mt-1",children:(0,a.jsx)(o.E,{variant:"ACTIVE"===e.subscription_status?"default":"secondary",children:e.subscription_status})})]}),(0,a.jsx)(i.$,{onClick:()=>E(!0),className:"w-full mt-2",disabled:I,children:I?"Updating...":"Change Plan"})]})]}),(0,a.jsxs)(l.Wq,{className:"border rounded-lg p-6 flex flex-col",shadowColor:"rgba(0,0,0,0.08)",shadowIntensity:.12,hoverScale:1.02,hoverLift:-1,transitionDuration:150,children:[(0,a.jsx)(n.aR,{children:(0,a.jsx)(n.ZB,{children:"Usage Dashboard"})}),(0,a.jsx)(n.Wu,{children:c?(0,a.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm mb-2",children:[(0,a.jsx)("span",{children:"Events"}),(0,a.jsxs)("span",{children:[c.current_events_count," / ",c.max_events]})]}),(0,a.jsx)(u,{value:z.events,className:"h-2"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm mb-2",children:[(0,a.jsx)("span",{children:"Users"}),(0,a.jsxs)("span",{children:[c.current_users_count," / ",c.max_users]})]}),(0,a.jsx)(u,{value:z.users,className:"h-2"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm mb-2",children:[(0,a.jsx)("span",{children:"Storage"}),(0,a.jsxs)("span",{children:[c.current_storage_mb,"MB / ",c.max_storage_mb,"MB"]})]}),(0,a.jsx)(u,{value:z.storage,className:"h-2"})]})]}),C.length>0&&(0,a.jsx)("div",{className:"bg-yellow-50 text-yellow-800 p-3 rounded-md text-sm",children:C.map((e,t)=>(0,a.jsx)("div",{children:e},t))})]}):(0,a.jsx)("div",{className:"text-gray-500",children:"Loading usage data..."})})]})]}),S&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold mb-6",children:"Choose Your Plan"}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:t.map(t=>(0,a.jsx)(l.Wq,{className:"border rounded-lg p-6 cursor-pointer ".concat(t.name===(null==r?void 0:r.name)?"border-primary ring-2 ring-primary bg-blue-50":"border-gray-200 hover:border-primary"),shadowColor:"rgba(0,0,0,0.08)",shadowIntensity:.12,hoverScale:1.02,hoverLift:-2,transitionDuration:150,children:(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-lg font-semibold",children:t.display_name}),(0,a.jsx)("div",{className:"text-sm text-gray-600 mb-2",children:t.description}),(0,a.jsx)("div",{className:"text-xl font-bold text-primary mb-4",children:P(t.price_monthly,t.price_yearly)})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-600 space-y-1",children:[(0,a.jsxs)("div",{children:["• ",t.max_events," events"]}),(0,a.jsxs)("div",{children:["• ",t.max_users," users"]}),(0,a.jsxs)("div",{children:["• ",t.max_storage_mb,"MB storage"]}),t.features&&"object"==typeof t.features&&Object.entries(t.features).map(e=>{let[t,r]=e;return(0,a.jsxs)("div",{children:["• ",String(r)]},t)})]}),t.price_monthly>0&&(0,a.jsx)(g,{amount:Math.round(100*t.price_monthly),currency:"USD",customer:{customer_id:e.id,customer_email:e.contact_email||"admin@organization.com",customer_phone:e.contact_phone||"0000000000"},onSuccess:()=>T(t.name)}),(0,a.jsx)(i.$,{size:"sm",className:"mt-2",variant:t.name===(null==r?void 0:r.name)?"outline":"default",disabled:t.name===(null==r?void 0:r.name)||I,onClick:()=>T(t.name),children:t.name===(null==r?void 0:r.name)?"Current Plan":"Select Plan"})]})},t.id))}),(0,a.jsx)(i.$,{variant:"outline",onClick:()=>E(!1),className:"w-full",children:"Cancel"})]})}),(0,a.jsx)("div",{className:"mt-12",children:(0,a.jsxs)(n.Zp,{className:"shadow-sm border border-gray-200",children:[(0,a.jsx)(n.aR,{children:(0,a.jsx)(n.ZB,{children:"Invoice History"})}),(0,a.jsx)(n.Wu,{children:v?(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:"Loading invoices..."}):0===y.length?(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:"No invoices found"}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b",children:[(0,a.jsx)("th",{className:"p-3 text-left text-gray-700",children:"Invoice #"}),(0,a.jsx)("th",{className:"p-3 text-left text-gray-700",children:"Date"}),(0,a.jsx)("th",{className:"p-3 text-left text-gray-700",children:"Amount"}),(0,a.jsx)("th",{className:"p-3 text-left text-gray-700",children:"Plan"}),(0,a.jsx)("th",{className:"p-3 text-left text-gray-700",children:"Status"}),(0,a.jsx)("th",{className:"p-3 text-left text-gray-700",children:"Action"})]})}),(0,a.jsx)("tbody",{children:y.map(e=>(0,a.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"p-3",children:e.invoice_number}),(0,a.jsx)("td",{className:"p-3",children:new Date(e.issue_date).toLocaleDateString()}),(0,a.jsxs)("td",{className:"p-3",children:["$",e.amount.toFixed(2)]}),(0,a.jsx)("td",{className:"p-3",children:e.plan_name}),(0,a.jsx)("td",{className:"p-3",children:(0,a.jsx)(o.E,{variant:"PAID"===e.status?"default":"PENDING"===e.status?"secondary":"destructive",children:e.status})}),(0,a.jsx)("td",{className:"p-3",children:(0,a.jsx)(i.$,{size:"sm",variant:"outline",children:"Download"})})]},e.id))})]})})})]})})]})})}},25121:(e,t,r)=>{"use strict";r.d(t,{E:()=>o});var a=r(95155);r(12115);var s=r(31027),n=r(21567);let i=(0,s.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function o(e){let{className:t,variant:r,...s}=e;return(0,a.jsx)("div",{className:(0,n.cn)(i({variant:r}),t),...s})}},73312:(e,t,r)=>{"use strict";r.d(t,{$:()=>c});var a=r(95155),s=r(12115),n=r(12317),i=r(31027),o=r(21567);let l=(0,i.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=s.forwardRef((e,t)=>{let{className:r,variant:s,size:i,asChild:c=!1,...d}=e,u=c?n.DX:"button";return(0,a.jsx)(u,{className:(0,o.cn)(l({variant:s,size:i,className:r})),ref:t,...d})});c.displayName="Button"},22130:(e,t,r)=>{"use strict";r.d(t,{BT:()=>c,Wu:()=>d,ZB:()=>l,Zp:()=>i,aR:()=>o,wL:()=>u});var a=r(95155),s=r(12115),n=r(21567);let i=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...s})});i.displayName="Card";let o=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",r),...s})});o.displayName="CardHeader";let l=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("h3",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",r),...s})});l.displayName="CardTitle";let c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("p",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",r),...s})});c.displayName="CardDescription";let d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",r),...s})});d.displayName="CardContent";let u=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",r),...s})});u.displayName="CardFooter"},67427:(e,t,r)=>{"use strict";r.d(t,{BN:()=>l,Wq:()=>i});var a=r(95155),s=r(12115),n=r(21567);function i(e){let{children:t,className:r,shadowColor:i="rgba(59,130,246,0.25)",shadowIntensity:o=.15,shadowSize:l=40,blurRadius:c=32,spreadRadius:d=0,transitionDuration:u=300,hoverScale:m=1.02,hoverLift:x=-5,disabled:h=!1}=e,[g,p]=(0,s.useState)(!1),f=(0,s.useRef)(null);return(0,a.jsx)("div",{ref:f,className:(0,n.cn)("relative transition-all duration-300 ease-in-out",r),style:g?{boxShadow:"0 ".concat(l,"px ").concat(c,"px ").concat(i,", 0 ").concat(2*l,"px ").concat(2*c,"px rgba(0,0,0,0.15)"),transform:"scale(".concat(m,") translateY(").concat(x,"px)"),transition:"all ".concat(u,"ms ease-in-out")}:{boxShadow:"0 8px ".concat(c,"px ").concat(i.replace("0.25",o.toString()),", 0 16px ").concat(2*c,"px rgba(0,0,0,0.1)"),transform:"scale(1) translateY(0px)",transition:"all ".concat(u,"ms ease-in-out")},onMouseEnter:()=>{h||p(!0)},onMouseLeave:()=>{h||p(!1)},children:t})}let o={blue:{shadowColor:"rgba(59,130,246,0.25)",shadowIntensity:.15},purple:{shadowColor:"rgba(168,85,247,0.25)",shadowIntensity:.15},green:{shadowColor:"rgba(34,197,94,0.25)",shadowIntensity:.15},cyan:{shadowColor:"rgba(6,182,212,0.25)",shadowIntensity:.15},red:{shadowColor:"rgba(239,68,68,0.25)",shadowIntensity:.15},orange:{shadowColor:"rgba(249,115,22,0.25)",shadowIntensity:.15},yellow:{shadowColor:"rgba(234,179,8,0.25)",shadowIntensity:.15},pink:{shadowColor:"rgba(236,72,153,0.25)",shadowIntensity:.15}};function l(e){let{children:t,theme:r="blue",className:s,...l}=e,c=o[r];return(0,a.jsx)(i,{className:(0,n.cn)("bg-white border border-gray-200 rounded-2xl p-6 cursor-pointer",s),shadowColor:c.shadowColor,shadowIntensity:c.shadowIntensity,...l,children:t})}},47767:(e,t,r)=>{"use strict";r.d(t,{OrganizationProvider:()=>l,Z:()=>o});var a=r(95155),s=r(12115),n=r(11712);let i=(0,s.createContext)(void 0),o=()=>{let e=(0,s.useContext)(i);if(void 0===e)throw Error("useOrganization must be used within an OrganizationProvider");return e},l=e=>{let{children:t}=e,[r,o]=(0,s.useState)(null),[l,c]=(0,s.useState)([]),[d,u]=(0,s.useState)([]),[m,x]=(0,s.useState)(null),[h,g]=(0,s.useState)(!1),[p,f]=(0,s.useState)(null),_=async e=>{try{g(!0),f(null);let{data:t,error:r}=await n.ND.from("users").select("organization_id").eq("id",e).single();if(r)throw r;if(!(null==t?void 0:t.organization_id)){o(null),c([]),u([]),x(null);return}let{data:a,error:s}=await n.ND.from("organizations").select("*").eq("id",t.organization_id).single();if(s)throw s;o(a)}catch(e){console.error("Error loading organization:",e),f(e instanceof Error?e.message:"Failed to load organization")}finally{g(!1)}},b=async e=>{try{g(!0),f(null);let{data:t,error:r}=await n.ND.from("organizations").select("*").eq("id",e).single();if(r)throw r;o(t)}catch(e){console.error("Error loading organization by ID:",e),f(e instanceof Error?e.message:"Failed to load organization"),o(null),c([]),u([]),x(null)}finally{g(!1)}},y=async()=>{if(r)try{let{data:e,error:t}=await n.ND.from("event_spaces").select("*").eq("organization_id",r.id).order("created_at",{ascending:!0});if(t)throw t;c(e||[])}catch(e){console.error("Error loading event spaces:",e),f(e instanceof Error?e.message:"Failed to load event spaces")}},v=async()=>{if(r)try{let{data:e,error:t}=await n.ND.from("users").select("*").eq("organization_id",r.id).order("joined_at",{ascending:!0});if(t)throw t;u(e||[])}catch(e){console.error("Error loading members:",e),f(e instanceof Error?e.message:"Failed to load members")}},w=async()=>{if(r)try{let{data:e,error:t}=await n.ND.from("organization_dashboard_stats").select("*").eq("organization_id",r.id).single();if(t)throw t;x(e)}catch(e){console.error("Error loading stats:",e),f(e instanceof Error?e.message:"Failed to load stats")}},N=async e=>{if(!r)throw Error("No organization selected");try{let{data:t,error:a}=await n.ND.from("event_spaces").insert({...e,organization_id:r.id}).select().single();if(a)throw a;return await y(),t}catch(e){throw console.error("Error creating event space:",e),e}},j=async e=>{if(!r)throw Error("No organization selected");try{let{error:t}=await n.ND.from("organizations").update(e).eq("id",r.id);if(t)throw t;await _(r.created_by)}catch(e){throw console.error("Error updating organization:",e),e}},S=async(e,t)=>{if(!r)throw Error("No organization selected");try{let{error:e}=await n.ND.rpc("add_user_to_organization",{p_user_id:null,p_organization_id:r.id,p_added_by:r.created_by,p_role_in_org:t});if(e)throw e;await v()}catch(e){throw console.error("Error inviting member:",e),e}},E=async e=>{if(!r)throw Error("No organization selected");try{let{error:t}=await n.ND.rpc("remove_user_from_organization",{p_user_id:e,p_organization_id:r.id,p_removed_by:r.created_by});if(t)throw t;await v()}catch(e){throw console.error("Error removing member:",e),e}},I=async(e,t)=>{if(!r)throw Error("No organization selected");try{let{error:a}=await n.ND.from("users").update({role_in_org:t,is_org_admin:"OWNER"===t||"ADMIN"===t}).eq("id",e).eq("organization_id",r.id);if(a)throw a;await v()}catch(e){throw console.error("Error updating member role:",e),e}},D=async()=>{r&&await Promise.all([_(r.created_by),y(),v(),w()])};return(0,s.useEffect)(()=>{r&&(y(),v(),w())},[null==r?void 0:r.id]),(0,a.jsx)(i.Provider,{value:{organization:r,eventSpaces:l,members:d,stats:m,isLoading:h,error:p,loadOrganization:_,loadOrganizationById:b,loadEventSpaces:y,loadMembers:v,loadStats:w,createEventSpace:N,updateOrganization:j,inviteMember:S,removeMember:E,updateMemberRole:I,refreshOrganization:D,clearOrganization:()=>{o(null),c([]),u([]),x(null),f(null)}},children:t})}},65564:(e,t,r)=>{"use strict";r.d(t,{dj:()=>m});var a=r(12115);let s=0,n=new Map,i=e=>{if(n.has(e))return;let t=setTimeout(()=>{n.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);n.set(e,t)},o=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:r}=t;return r?i(r):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},l=[],c={toasts:[]};function d(e){c=o(c,e),l.forEach(e=>{e(c)})}function u(e){let{...t}=e,r=(s=(s+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>d({type:"DISMISS_TOAST",toastId:r});return d({type:"ADD_TOAST",toast:{...t,id:r,open:!0,onOpenChange:e=>{e||a()}}}),{id:r,dismiss:a,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:r}})}}function m(){let[e,t]=a.useState(c);return a.useEffect(()=>(l.push(t),()=>{let e=l.indexOf(t);e>-1&&l.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},11712:(e,t,r)=>{"use strict";r.d(t,{ND:()=>i});var a=r(96232);let s="https://pcezsgzlomtzbanwbyyj.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBjZXpzZ3psb210emJhbndieXlqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI5MDE5MTcsImV4cCI6MjA2ODQ3NzkxN30.TjuBbUmpxmnite9B6Uj0jy-rPGHTyiudf1bnifPzbmc";s&&n||console.warn("Supabase credentials not found. Please set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY environment variables.");let i=(0,a.UU)(s,n)},21567:(e,t,r)=>{"use strict";r.d(t,{cn:()=>n});var a=r(43463),s=r(69795);function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.QP)((0,a.$)(t))}}},e=>{var t=t=>e(e.s=t);e.O(0,[1181,6232,8624,8441,1517,7358],()=>t(33146)),_N_E=e.O()}]);
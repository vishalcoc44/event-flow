"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4934],{17146:(e,r,a)=>{a.d(r,{A:()=>l,AuthProvider:()=>d});var t=a(95155),i=a(12115),o=a(76046),n=a(11712);let s=(0,i.createContext)(void 0),d=e=>{let{children:r}=e,[a,d]=(0,i.useState)(null),[l,u]=(0,i.useState)(!0),c=(0,o.useRouter)();(0,i.useEffect)(()=>{let{data:{subscription:e}}=n.ND.auth.onAuthStateChange(async(e,r)=>{var a,t,i;if(console.log("Auth state change:",e,!!r,null===(t=window)||void 0===t?void 0:null===(a=t.location)||void 0===a?void 0:a.pathname),r&&r.user){let a={id:r.user.id,email:r.user.email||"",role:r.user.user_metadata.role||"USER",username:r.user.user_metadata.username||(null===(i=r.user.email)||void 0===i?void 0:i.split("@")[0])||"",first_name:r.user.user_metadata.first_name,last_name:r.user.user_metadata.last_name,contact_number:r.user.user_metadata.contact_number,city:r.user.user_metadata.city,pincode:r.user.user_metadata.pincode,street_address:r.user.user_metadata.street_address,created_at:r.user.created_at};try{let{data:e,error:t}=await n.ND.from("users").select("organization_id, role_in_org, is_org_admin, joined_at").eq("id",r.user.id).single();!t&&e&&Object.assign(a,{organization_id:e.organization_id,role_in_org:e.role_in_org,is_org_admin:e.is_org_admin,joined_at:e.joined_at})}catch(e){console.error("Error loading organization data:",e)}if(d(a),"SIGNED_IN"===e){let e=window.location.pathname,r=window.location.search,t=r.includes("type=recovery")||r.includes("access_token");if("/reset-password"===e||"/forgot-password"===e||"/login"===e||"/register"===e||t){console.log("Skipping redirect - auth page or password reset flow"),u(!1);return}"ADMIN"===a.role?c.push("/admin/dashboard"):c.push("/customer/dashboard")}}else d(null);u(!1)});(async()=>{let{data:{session:e}}=await n.ND.auth.getSession();if(e&&e.user){var r;let a={id:e.user.id,email:e.user.email||"",role:e.user.user_metadata.role||"USER",username:e.user.user_metadata.username||(null===(r=e.user.email)||void 0===r?void 0:r.split("@")[0])||"",first_name:e.user.user_metadata.first_name,last_name:e.user.user_metadata.last_name,contact_number:e.user.user_metadata.contact_number,city:e.user.user_metadata.city,pincode:e.user.user_metadata.pincode,street_address:e.user.user_metadata.street_address,created_at:e.user.created_at};try{let{data:r,error:t}=await n.ND.from("users").select("organization_id, role_in_org, is_org_admin, joined_at").eq("id",e.user.id).single();!t&&r&&Object.assign(a,{organization_id:r.organization_id,role_in_org:r.role_in_org,is_org_admin:r.is_org_admin,joined_at:r.joined_at})}catch(e){console.error("Error loading organization data:",e)}d(a)}u(!1)})();let r=setTimeout(()=>{console.warn("Auth loading timeout reached, resetting loading state"),u(!1)},1e4);return()=>{e.unsubscribe(),clearTimeout(r)}},[]);let _=async(e,r)=>{try{u(!0);let{data:t,error:i}=await n.ND.auth.signInWithPassword({email:e,password:r});if(i)throw i;if(!t.user)throw Error("No user data received");let o=t.user.user_metadata.role||"USER";try{let{data:e,error:r}=await n.ND.from("users").select("organization_id, role_in_org, is_org_admin, joined_at").eq("id",t.user.id).single();if(!r&&e){var a;let r={id:t.user.id,email:t.user.email||"",role:o,username:t.user.user_metadata.username||(null===(a=t.user.email)||void 0===a?void 0:a.split("@")[0])||"",first_name:t.user.user_metadata.first_name,last_name:t.user.user_metadata.last_name,contact_number:t.user.user_metadata.contact_number,city:t.user.user_metadata.city,pincode:t.user.user_metadata.pincode,street_address:t.user.user_metadata.street_address,created_at:t.user.created_at,organization_id:e.organization_id,role_in_org:e.role_in_org,is_org_admin:e.is_org_admin,joined_at:e.joined_at};d(r)}}catch(e){console.error("Error loading organization data:",e)}if(u(!1),"/reset-password"===window.location.pathname)return!0;return"ADMIN"===o?c.push("/admin/dashboard"):c.push("/customer/dashboard"),!0}catch(e){return console.error("Login error:",e),u(!1),!1}},m=async()=>{try{await n.ND.auth.signOut(),d(null),c.push("/login")}catch(e){console.error("Logout error:",e)}},g=async e=>{try{u(!0);let{data:r,error:a}=await n.ND.auth.signUp({email:e.email,password:e.password,options:{data:{username:e.username||e.email.split("@")[0],first_name:e.firstName||"",last_name:e.lastName||"",contact_number:e.contactNumber||"",city:e.city||"",pincode:e.pincode||"",street_address:e.streetAddress||"",role:e.role||"USER"}}});if(a)throw a;if(r.user){if(e.isAdminRequest)try{let{error:a}=await n.ND.rpc("create_admin_request",{p_user_id:r.user.id,p_email:e.email,p_reason:"Admin access requested during registration",p_first_name:e.firstName||"",p_last_name:e.lastName||"",p_contact_number:e.contactNumber||"",p_organization:"",p_experience_level:"INTERMEDIATE",p_intended_use:"Event management and administration"});a&&console.error("Error creating admin request:",a)}catch(e){console.error("Error creating admin request:",e)}else try{let{data:r,error:a}=await n.ND.auth.signInWithPassword({email:e.email,password:e.password});if(a)throw a;let t=e.role||"USER";"ADMIN"===t?c.push("/admin/dashboard"):c.push("/customer/dashboard")}catch(e){console.error("Error signing in after registration:",e),c.push("/login")}}return!0}catch(e){return console.error("Registration error:",e),!1}finally{u(!1)}};return(0,t.jsx)(s.Provider,{value:{user:a,login:_,logout:m,register:g,isLoading:l},children:r})},l=()=>{let e=(0,i.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},47767:(e,r,a)=>{a.d(r,{OrganizationProvider:()=>d,Z:()=>s});var t=a(95155),i=a(12115),o=a(11712);let n=(0,i.createContext)(void 0),s=()=>{let e=(0,i.useContext)(n);if(void 0===e)throw Error("useOrganization must be used within an OrganizationProvider");return e},d=e=>{let{children:r}=e,[a,s]=(0,i.useState)(null),[d,l]=(0,i.useState)([]),[u,c]=(0,i.useState)([]),[_,m]=(0,i.useState)(null),[g,h]=(0,i.useState)(!1),[w,f]=(0,i.useState)(null),p=async e=>{try{h(!0),f(null);let{data:r,error:a}=await o.ND.from("users").select("organization_id").eq("id",e).single();if(a)throw a;if(!(null==r?void 0:r.organization_id)){s(null),l([]),c([]),m(null);return}let{data:t,error:i}=await o.ND.from("organizations").select("*").eq("id",r.organization_id).single();if(i)throw i;s(t)}catch(e){console.error("Error loading organization:",e),f(e instanceof Error?e.message:"Failed to load organization")}finally{h(!1)}},y=async e=>{try{h(!0),f(null);let{data:r,error:a}=await o.ND.from("organizations").select("*").eq("id",e).single();if(a)throw a;s(r)}catch(e){console.error("Error loading organization by ID:",e),f(e instanceof Error?e.message:"Failed to load organization"),s(null),l([]),c([]),m(null)}finally{h(!1)}},z=async()=>{if(a)try{let{data:e,error:r}=await o.ND.from("event_spaces").select("*").eq("organization_id",a.id).order("created_at",{ascending:!0});if(r)throw r;l(e||[])}catch(e){console.error("Error loading event spaces:",e),f(e instanceof Error?e.message:"Failed to load event spaces")}},N=async()=>{if(a)try{let{data:e,error:r}=await o.ND.from("users").select("*").eq("organization_id",a.id).order("joined_at",{ascending:!0});if(r)throw r;c(e||[])}catch(e){console.error("Error loading members:",e),f(e instanceof Error?e.message:"Failed to load members")}},E=async()=>{if(a)try{let{data:e,error:r}=await o.ND.from("organization_dashboard_stats").select("*").eq("organization_id",a.id).single();if(r)throw r;m(e)}catch(e){console.error("Error loading stats:",e),f(e instanceof Error?e.message:"Failed to load stats")}},b=async e=>{if(!a)throw Error("No organization selected");try{let{data:r,error:t}=await o.ND.from("event_spaces").insert({...e,organization_id:a.id}).select().single();if(t)throw t;return await z(),r}catch(e){throw console.error("Error creating event space:",e),e}},v=async e=>{if(!a)throw Error("No organization selected");try{let{error:r}=await o.ND.from("organizations").update(e).eq("id",a.id);if(r)throw r;await p(a.created_by)}catch(e){throw console.error("Error updating organization:",e),e}},D=async(e,r)=>{if(!a)throw Error("No organization selected");try{let{error:e}=await o.ND.rpc("add_user_to_organization",{p_user_id:null,p_organization_id:a.id,p_added_by:a.created_by,p_role_in_org:r});if(e)throw e;await N()}catch(e){throw console.error("Error inviting member:",e),e}},I=async e=>{if(!a)throw Error("No organization selected");try{let{error:r}=await o.ND.rpc("remove_user_from_organization",{p_user_id:e,p_organization_id:a.id,p_removed_by:a.created_by});if(r)throw r;await N()}catch(e){throw console.error("Error removing member:",e),e}},S=async(e,r)=>{if(!a)throw Error("No organization selected");try{let{error:t}=await o.ND.from("users").update({role_in_org:r,is_org_admin:"OWNER"===r||"ADMIN"===r}).eq("id",e).eq("organization_id",a.id);if(t)throw t;await N()}catch(e){throw console.error("Error updating member role:",e),e}},A=async()=>{a&&await Promise.all([p(a.created_by),z(),N(),E()])};return(0,i.useEffect)(()=>{a&&(z(),N(),E())},[null==a?void 0:a.id]),(0,t.jsx)(n.Provider,{value:{organization:a,eventSpaces:d,members:u,stats:_,isLoading:g,error:w,loadOrganization:p,loadOrganizationById:y,loadEventSpaces:z,loadMembers:N,loadStats:E,createEventSpace:b,updateOrganization:v,inviteMember:D,removeMember:I,updateMemberRole:S,refreshOrganization:A,clearOrganization:()=>{s(null),l([]),c([]),m(null),f(null)}},children:r})}},11712:(e,r,a)=>{a.d(r,{ND:()=>n});var t=a(96232);let i="https://pcezsgzlomtzbanwbyyj.supabase.co",o="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBjZXpzZ3psb210emJhbndieXlqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI5MDE5MTcsImV4cCI6MjA2ODQ3NzkxN30.TjuBbUmpxmnite9B6Uj0jy-rPGHTyiudf1bnifPzbmc";i&&o||console.warn("Supabase credentials not found. Please set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY environment variables.");let n=(0,t.UU)(i,o)},21567:(e,r,a)=>{a.d(r,{cn:()=>o});var t=a(43463),i=a(69795);function o(){for(var e=arguments.length,r=Array(e),a=0;a<e;a++)r[a]=arguments[a];return(0,i.QP)((0,t.$)(r))}}}]);